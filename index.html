<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Temmie Clicker v3.1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
  body{
    margin:0;
    height:100vh;
    background:black;
    font-family: 'Press Start 2P', monospace;
    color:white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .clicker{
    width: clamp(150px, 25vw, 300px);
    cursor:pointer;
    transition: transform 200ms ease, filter 200ms ease;
  }

  .clicker:hover{
    transform: scale(1.1);
    filter: brightness(1.2);
  }

  .counter{
    position: fixed;
    top:20px;
    left:20px;
    font-size:32px;
    color:white;
    text-shadow: 0 0 8px #fff, 0 0 12px #0ff;
  }

  .store {
    margin-top: 20px;
    background: #111;
    border: 2px solid #0ff;
    padding: 10px;
    border-radius: 10px;
    text-align: center;
    width: clamp(200px, 50vw, 400px);
  }

  .store h2 {
    font-size: 16px;
    margin-bottom: 10px;
  }

  .item {
    display: flex;
    justify-content: space-between;
    margin: 6px 0;
    padding: 6px;
    border: 1px solid #0ff;
    cursor: pointer;
    transition: background 200ms ease;
  }

  .item:hover {
    background: #0ff3;
  }

  /* Overlay cheat message */
  .cheat-overlay {
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.85);
    z-index: 9999;
  }

  .cheat-message {
    color: #ff2f2f;
    font-size: 28px;
    text-align: center;
    padding: 20px;
    border: 3px solid #ff2f2f;
    border-radius: 8px;
    background: #111;
    text-shadow: 0 0 10px #ff2f2f;
  }

  </style>
</head>
<body>
  <div class="counter" id="counter">0</div>

  <main class="wrap">
    <img src="SPOILER_8540b063b4e8b069ecc7a695bd353bda.webp" width="353" height="363" id="clicker" class="clicker" alt="Clicker" />
  </main>

  <div class="store">
    <h2>ðŸ›’ Tienda Temmie</h2>
    <div class="item" onclick="buyPowerup('autoClick')">Autoclick (+1 click/seg) - 50</div>
    <div class="item" onclick="buyPowerup('multiplier')">Multiplicador x2 - 200 (mÃ¡x 2)</div>
    <div class="item" onclick="buyPowerup('bonus')">Bonus temporal (doble clicks 10s) - 100</div>
    <div class="item" onclick="buyPowerup('college')">Temmie College (+5 clicks/seg) - 500</div>
    <div class="item" onclick="buyPowerup('madness')">Racha de Locura (x5 clicks 5s) - 1500</div>
    <div class="item" onclick="buyPowerup('army')">EjÃ©rcito de Temmies (+20 clicks/seg) - 10000</div>
    <div class="item" onclick="buyPowerup('godMode')">ðŸŒŒ Modo Dios (x10 permanente) - 50000 (Ãºnico)</div>
  </div>

  <div class="cheat-overlay" id="cheatOverlay">
    <div class="cheat-message" id="cheatMsg">shat up hacke!!</div>
  </div>

<noscript>Activa JavaScript para jugar.</noscript>

<script>
const clickBtn = document.getElementById('clicker');
const counterEl = document.getElementById('counter');
const cheatOverlay = document.getElementById('cheatOverlay');

let count = 0;
let autoClickers = 0;
let multiplier = 1;
let bonusActive = false;

// LÃ­mites de compras
let multiplierCount = 0;
let superMultiplierBought = false;
let godModeBought = false;

const CHEAT_THRESHOLD = 1e15; // umbral para detectar nÃºmeros absurdos

// Cargar juego
try {
  const saved = localStorage.getItem('undertale_clicker_data');
  if(saved){
    const data = JSON.parse(saved);
    count = data.count || 0;
    autoClickers = data.autoClickers || 0;
    multiplier = data.multiplier || 1;
    multiplierCount = data.multiplierCount || 0;
    superMultiplierBought = data.superMultiplierBought || false;
    godModeBought = data.godModeBought || false;
  }
}catch(e){ console.warn('localStorage disabled', e); }

function saveGame(){
  try{
    localStorage.setItem('undertale_clicker_data', JSON.stringify({
      count,
      autoClickers,
      multiplier,
      multiplierCount,
      superMultiplierBought,
      godModeBought
    }));
  }catch(e){}
}

function updateDisplay(){
  // Mostrar con toLocaleString para legibilidad si es finito
  if(!isFinite(count)) counterEl.textContent = String(count);
  else counterEl.textContent = Math.floor(count).toLocaleString();
}

function resetForCheat(){
  // Resetea todo a estado base (mÃ¡s seguro)
  count = 0;
  autoClickers = 0;
  multiplier = 1;
  multiplierCount = 0;
  superMultiplierBought = false;
  godModeBought = false;
  saveGame();
  updateDisplay();
}

// DetecciÃ³n de cheats
function detectCheat(){
  try {
    // condiciÃ³n: no es finito, o supera el umbral, o su representaciÃ³n contiene 'e' (notaciÃ³n cientÃ­fica)
    if(!isFinite(count) || count > CHEAT_THRESHOLD || String(count).toLowerCase().includes('e')){
      return true;
    }
  } catch(e){
    return true;
  }
  return false;
}

function triggerCheatResponse(){
  // Si ya estÃ¡ mostrando overlay, no lo repitamos
  if(cheatOverlay.style.display === 'flex') return;

  // Mostrar overlay y resetear
  cheatOverlay.style.display = 'flex';
  resetForCheat();

  // Mantener mensaje 5s y luego ocultar
  setTimeout(()=>{
    cheatOverlay.style.display = 'none';
  }, 5000);
}

function addClick(amount=1){
  // Primero aÃ±ade normalmente
  if(bonusActive) amount *= 2;
  count += amount * multiplier;

  // Detectar cheats justo despuÃ©s del cambio
  if(detectCheat()){
    triggerCheatResponse();
  } else {
    updateDisplay();
    saveGame();
  }
}

clickBtn.addEventListener('click', ()=> addClick());

// tecla espacio tambiÃ©n cuenta
window.addEventListener('keydown', (e)=>{
  if(e.code === 'Space'){
    e.preventDefault();
    clickBtn.click();
  }
});

// ---- Powerups ----
function buyPowerup(type){
  switch(type){
    case 'autoClick':
      if(count >= 50){ count -= 50; autoClickers++; }
      break;

    case 'multiplier':
      if(count >= 200 && multiplierCount < 2){
        count -= 200;
        multiplier *= 2;
        multiplierCount++;
      }
      break;

    case 'bonus':
      if(count >= 100){
        count -= 100;
        if(!bonusActive){
          bonusActive = true;
          setTimeout(()=> bonusActive = false, 10000);
        }
      }
      break;

    case 'college':
      if(count >= 500){ count -= 500; autoClickers += 5; } // nerfeado a +5
      break;

    case 'madness':
      if(count >= 1500){
        count -= 1500;
        let oldMult = multiplier;
        multiplier *= 5;
        setTimeout(()=> multiplier = oldMult, 5000);
      }
      break;

    case 'army':
      if(count >= 10000){ count -= 10000; autoClickers += 20; } // nerfeado a +20
      break;

    case 'godMode':
      if(count >= 50000 && !godModeBought){
        count -= 50000;
        multiplier *= 10;
        godModeBought = true;
      }
      break;
  }

  // Tras comprar, revisamos cheat por si el jugador hackeÃ³ el valor antes de comprar
  if(detectCheat()){
    triggerCheatResponse();
  } else {
    updateDisplay();
    saveGame();
  }
}

// Autoclickers
setInterval(()=>{
  if(autoClickers > 0){
    addClick(autoClickers);
  }
}, 1000);

// Chequeo periÃ³dico por si el valor se modifica externamente
setInterval(()=>{
  if(detectCheat()){
    triggerCheatResponse();
  }
}, 1000);

// Inicializa la UI
updateDisplay();
</script>
</body>
</html>
